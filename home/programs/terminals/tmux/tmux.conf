# # # # # # # # # # # # # # # #
# HACKIRI's tmux config
# Date: 09-09-2024
#
# This is a custom tmux config for
# my personal use.
#
# All Rights Reserved
# # # # # # # # # # # # # # # #

## Fix Colors
set-option -g default-terminal "tmux-256color"

# Enable true color support
set-option -a terminal-features 'tmux-256color:RGB'
set-option -a terminal-overrides 'xterm-256color:RGB'

# Enable passthrough for image.nvim
set -g allow-passthrough on

#### Action key
set-option -g prefix C-b
set-option -g prefix2 none
set-option -g repeat-time 0
set-option -g focus-events on

## Reload Config: checks at both locations
bind r if-shell "[ -f ~/.config/tmux/tmux.conf ]" \
    "source-file ~/.config/tmux/tmux.conf \; display-message 'Config reloaded from .config/tmux/tmux.conf!'" \
    "source-file ~/.tmux.conf \; display-message 'Config reloaded from .tmux.conf!'"

## New window
bind c new-window -c "#{pane_current_path}"

## Set tmux to allow renaming windows and disable automatic renaming
set -wg automatic-rename on
set -g automatic-rename-format "#{pane_current_command}"

## Split Panes
bind '"' split-window -c "#{pane_current_path}"
bind % split-window -h -c "#{pane_current_path}"

## Copy Mode  https://waylonwalker.com/tmux-copy-mode/
setw -g mode-keys vi
bind Enter copy-mode
bind -n M-Enter copy-mode

bind-key -T copy-mode-vi 'v' send-keys -X begin-selection
bind-key -T copy-mode-vi 'y' send-keys -X copy-selection
bind-key -T copy-mode-vi 'c' send-keys -X copy-pipe 'pbcopy'

## Navigate TMUX Windows. (Must edit the terminal config to send these keys)
bind -n C-Tab select-window -n
bind -n C-S-Tab select-window -p

## vim-like pane switching : Requires vim-tmux-navigator plugin
bind -r h select-pane -L  
bind -r j select-pane -D
bind -r k select-pane -U 
bind -r l select-pane -R 

## vim-like pane resizing
bind -r h resize-pane -L 5
bind -r j resize-pane -D 5
bind -r k resize-pane -U 5
bind -r l resize-pane -R 5

## Sessions
bind o choose-session
bind C-n command-prompt -p "New Session:" "new-session -A -s '%%'"
bind C-r command-prompt -p "Rename Session:" "rename-session '%%'"
bind C-k confirm kill-session

## Tmux Sessionizer - Fuzzy find and switch to project directories
bind-key -r f run-shell "tmux neww tmux-sessionizer"

## Resurrect
# https://haseebmajid.dev/posts/2023-09-01-til-how-to-fix-tmux-resurrect-on-nixos/
resurrect_dir="$HOME/.tmux/resurrect"
set -g @resurrect-dir $resurrect_dir
set -g @resurrect-hook-post-save-all 'target=$(readlink -f $resurrect_dir/last); sed "s| --cmd .*-vim-pack-dir||g; s|/etc/profiles/per-user/$USER/bin/||g; s|/home/$USER/.nix-profile/bin/||g" $target | sponge $target'
set -g @resurrect-strategy-vim 'session'
set -g @resurrect-strategy-nvim 'session'
set -g @resurrect-capture-pane-contents 'on'

## Continuum
set -g @continuum-restore 'on'
set -g @continuum-save-interval '15'

## MISC
set -g mouse on
set -g renumber-windows on       # renumber all windows when any window is closed
set -g base-index 1              # start indexing windows at 1 instead of 0
set -g pane-base-index 1         # start indexing panes at 1 instead of 0
set -g detach-on-destroy off     # don't exit from tmux when closing a session
set -g history-limit 100000      # increase history size (from 2,000)

# Enable extended support for some more sophisticated terminal emulator
# features. Disable them if they are causing problems!
set-option -s focus-events on
set-option -s extended-keys on

# Disable waiting time when pressing escape, for smoother Neovim usage. Disable
# if differentiation between function and meta keycombination is needed.
set-option -s escape-time 0 

## Eldritch Color Scheme
# Eldritch theme colors (matching your Neovim config)
set -g @Eld_bg "#0D1116"        # color10 - main background
set -g @Eld_bg_alt "#141b22"    # color17 - secondary background
set -g @Eld_bg_highlight "#232e3b"  # color13 - highlighted background
set -g @Eld_fg "#ffffff"        # color14 - main foreground/text
set -g @Eld_fg_alt "#b7bfce"    # color09 - secondary text/comments
set -g @Eld_black "#0D1116"     # color10
set -g @Eld_gray "#565f89"      # gray for borders
set -g @Eld_cyan "#04d1f9"      # color03 - cyan
set -g @Eld_blue "#987afb"      # color04 - purple/blue
set -g @Eld_green "#37f499"     # color02 - green
set -g @Eld_yellow "#f1fc79"    # color12 - yellow
set -g @Eld_orange "#e58f2a"    # color08 - orange
set -g @Eld_red "#f16c75"       # color11 - red
set -g @Eld_pink "#fca6ff"      # color01 - pink/magenta
set -g @Eld_magenta "#f94dff"   # color24 - bright magenta
set -g @Eld_rosewater "#e9b3fd" # color16 - visual selection
set -g @Eld_overlay_0 "#b7bfce" # color09 - for separators

# Nerdfont characters
HALF_ROUND_OPEN="#(printf '\uE0B6')"
HALF_ROUND_CLOSE="#(printf '\uE0B4')"
TRIANGLE_OPEN="#(printf '\uE0B2')"
TRIANGLE_CLOSE="#(printf '\uE0B0')"

# Status Bar
set -g status-position top
set -g status-justify "absolute-centre"

# Enable Touch ID authentication in tmux
set-option -g default-command "reattach-to-user-namespace -l $SHELL"

## Pane Border Styling
set -g pane-border-format ''  # set the text shown in pane border status line
set -g pane-border-status bottom # top bottom off
set -g pane-border-lines  single # single simple double heavy
set -g pane-border-indicators colour # off colour arrows both
set -g pane-border-style 'fg=#9893a5'
set -g pane-active-border-style 'fg=#f6c177'

# allow the title bar to adapt to whatever host you connect to
set -g set-titles on
set -g set-titles-string "#{?client_prefix,#[fg=#{@Eld_red} bg=default]#[fg=#{@Eld_bg} bg=#{@Eld_red}]#S#[fg=#{@Eld_bg} bg=default],#[fg=#{@Eld_bg} bg=default]#[fg=#{@Eld_red} bg=#{@Eld_bg}]#S#[fg=#{@Eld_bg} bg=default]} #{pane_title}"

# Status-Line
set-option -gF status-style "bg=#{@Eld_bg},fg=#{@Eld_fg}"

# Status-Line :: Left
set -g status-left-length 100
set -g status-left ""
set -ga status-left "#{?client_prefix,#{#[bg=#{@Eld_red},fg=#{@Eld_bg},bold]  #S },#{#[bg=#{@Eld_bg},fg=#{@Eld_green}]  #S }}"
set -ga status-left "#[bg=#{@Eld_bg},fg=#{@Eld_overlay_0},none]│"
set -ga status-left "#[bg=#{@Eld_bg},fg=#{@Eld_blue}]  #{=/-32/...:#{s|$USER|~|:#{b:pane_current_path}}} "
set -ga status-left "#[bg=#{@Eld_bg},fg=#{@Eld_overlay_0},none]#{?window_zoomed_flag,│,}"
set -ga status-left "#[bg=#{@Eld_bg},fg=#{@Eld_yellow}]#{?window_zoomed_flag,  zoom ,}"

# Right Modules: Hostname + Time
set -g status-right-length 100
set -g status-right ""
set -ga status-right "#[bg=#{@Eld_bg},fg=#{@Eld_cyan}]  #H "
set -ga status-right "#[bg=#{@Eld_bg},fg=#{@Eld_overlay_0}, none]│"
set -ga status-right "#[bg=#{@Eld_bg},fg=#{@Eld_green}] %H:%M "

# Status-Line :: Window
set -g window-status-format "#I#{?#{!=:#{window_name},Window},: #W,}"
set -g window-status-style "bg=#{@Eld_bg},fg=#{@Eld_rosewater}"
set -g window-status-last-style "bg=#{@Eld_bg},fg=#{@Eld_rosewater}"
set -g window-status-activity-style "bg=#{@Eld_red},fg=#{@Eld_bg}"
set -g window-status-bell-style "bg=#{@Eld_red},fg=#{@Eld_bg},bold"
set -gF window-status-separator " "
set -g window-status-current-format "#[bg=#{@Eld_bg},fg=#f6c177]#(printf '\uE0B6')#[bg=#f6c177,fg=#{@Eld_bg}] #I#{?#{!=:#{window_name},Window},: #W,} #[bg=#{@Eld_bg},fg=#f6c177]#(printf '\uE0B4')"
set -g window-status-current-style "bg=#f6c177,fg=#{@Eld_bg},bold"
